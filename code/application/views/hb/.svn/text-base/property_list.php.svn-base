<div class="hostel-list block-620-small">
  <div class="block-620-top-small"></div>
  <div class="block-620-content-small clearfix">

    <div class="info">
      <a href="<?php echo site_url($this->link_hostel_page.'/'.url_title($hostel["name"]).'/'.$hostel["id"]); ?>">
      <?php 
      $hb_image = site_url('images/na_small.jpg');
      if(isset($hostel["image"]) && isset($searchmode) && ($searchmode==1))
      {
        $hb_image = substr($hostel["image"],0,-4);
        $hb_image.= "s";
        $hb_image.= substr($hostel["image"],-4);
      }
      elseif(isset($hostel["image"]))
      {
        $hb_image = $hostel["image"];
      }
      ?>
      <img src="<?php echo $hb_image; ?>" alt=""></a>
      <h2><a href="<?php echo site_url($this->link_hostel_page.'/'.url_title($hostel["name"]).'/'.$hostel["id"]); ?>"><?php echo $hostel["name"]; ?></a></h2>
      <p>
      <?php 
      //TONOTICE Unfortunately, HB API does not use the same variables names for a get location data VS a get location availability 

      //Short description mapping
      $hb_description = "";
      if(!empty($hostel["intro"]))
      {
        $hb_description = htmlspecialchars(strip_tags(word_limiter($hostel["intro"], 40, "...")));
      }
      elseif(!empty($hostel["shortdescription"]))
      {
        $hb_description = htmlspecialchars(strip_tags(word_limiter($hostel["shortdescription"], 40, "...")));
      }
      
      //Minimum price mapping
      $hb_price = NULL;
      if(!empty($hostel["prices"]["customer"]["minprice"]))
      {
        $hb_price = $hostel["prices"]["customer"]["minprice"];
      }
      elseif(!empty($hostel["prices"]["customer"]["minsharedprice"]))
      {
        //If t dorms are available (min shared rooms price > 0)
        if($hostel["prices"]["customer"]["minsharedprice"] > 0)
        {
          $hb_price = $hostel["prices"]["customer"]["minsharedprice"];
          //If private rooms are available  (price > 0) and private rooms prices are lower
          if(($hostel["prices"]["customer"]["minprivateprice"] > 0) && ($hb_price > $hostel["prices"]["customer"]["minprivateprice"]))
          {
            $hb_price = $hostel["prices"]["customer"]["minprivateprice"];
          }
        }
        elseif(!empty($hostel["prices"]["customer"]["minprivateprice"]))
        {
          $hb_price = $hostel["prices"]["customer"]["minprivateprice"];
        }
        
      }

      //Rating mapping
      $hostel_rating = NULL;
      if(!empty($hostel["rating"]))
      {
        $hostel_rating = $hostel["rating"];
      }
      elseif(!empty($hostel["percentagerating"]))
      {
        $hostel_rating = ceil($hostel["percentagerating"]);
      }
      
      //Short description display
      if(!empty($hostel["shortdescriptionTranslated"]))
      {
        echo '<span class="tooltip" title="'._("VERSION ORIGINALE :").' '.$hb_description.'">'.htmlspecialchars(strip_tags(word_limiter($hostel["shortdescriptionTranslated"], 40, "..."))).'</span>';
      }
      elseif(!empty($hostel["introTranslated"]))
      {
        echo '<span class="tooltip" title="'._("VERSION ORIGINALE :").' '.$hb_description.'">'.htmlspecialchars(strip_tags(word_limiter($hostel["introTranslated"], 40, "..."))).'</span>';
      }
      else
      {
        echo $hb_description;
      }
      ?>
    </p> 
        <?php 
        if (($searchmode == 1)&& isset($date_selected) && isset($numnights_selected))
        {
          ?>
          <p class="city-avail"><?php echo _("Disponibilités");?> :</p>
          <ul class="avail">
            <?php 
            $startStamp = strtotime($date_selected);
            
            for($day = 0; $day < $numnights_selected; $day++)
            {
              $actualStamp = mktime(0, 0, 0, date("m",$startStamp)  , date("d",$startStamp) + $day, date("Y",$startStamp));
              ?>
              <li><?php echo strftime('%d/%m/%y',$actualStamp);?></li>
              <?php 
            }
            ?> 
          </ul>
          <?php }else{?>
          <a href="<?php echo site_url($this->link_hostel_page.'/'.url_title($hostel["name"]).'/'.$hostel["id"]); ?>" class="more-info"><?php echo _("Plus sur cette auberge de jeunesse");?> &raquo;</a>
          <?php 
        }
        ?>
      </div>
      <div class="rating">
        <?php 
        if(isset($hostel["prices"]["customer"]))
        {
          ?>
          <p class="price">
          <?php echo _('à partir de');?>
            &nbsp;<?php echo $cur = currency_symbol($hostel["prices"]["customer"]["currency"]);?> <strong><?php echo $hb_price;?></strong></p>
          <?php 
        }
        ?>
        <?php 
        
        if(is_null($hostel_rating) || ($hostel_rating == 0))
        {
          ?>
         <p class="value no-rating" style=""><strong>0</strong></p>
         <p class="comment"><?php echo _("Not Rated Yet!"); ?></p>
         <?php /*?><p class="contest"><a href="<?php echo base_url().'info/'.url_title($hostel["name"]).'/'.$hostel["id"]; ?>#tab3">Commentez pour gagner un Ipod!</a></p><?php */?>
          <?php
        }
        else
        {
          ?>
          <p class="value">
          <?php echo _("évaluation moyenne");?><br /><strong title="<?php echo _("As rated by bookers like you"); ?>"><?php echo $hostel_rating;?></strong> %</p>
          <?php /*?><p class="comment"><?php printf (ngettext("%d commentaire", "%d commentaires", $hostel_rating->rating_count), $hostel_rating->rating_count); ?></p><?php */?>
          <?php
        }
        
        ?>

      </div>
      <a title="<?php printf( gettext("Réserver %s"),$hostel["name"][0]);?>" class="reserve" href="<?php echo site_url($this->link_hostel_page.'/'.url_title($hostel["name"]).'/'.$hostel["id"]); ?>"><?php echo _("Réserver");?></a>
  </div>
</div>