		<div id="main" class="hostel-view-page">
            <div class="col1">
            
              <?php
				//error handling standard
				if($api_error==false)
				{
				  //$hostel is set
				}
				elseif($api_error_msg==false)
				{
				  //serveur inaccessible en ce moment (HW only)
				}
				else
				{
				  //error message = $api_error_msg->UserMessage->message
				  //error details (en anglais) = $api_error_msg->UserMessage->detail
				  ?>
				  <h1 class="green-bar"><?php echo _("Erreur de requête");?></h1>
          <div class="dispo-error">
            <p><strong><?php echo _("Erreur:");?></strong>
            <?php 
              if(!empty($api_error_msg->messageTranslated))
              {
                echo $api_error_msg->messageTranslated;
              }
              else
              {
                echo $api_error_msg->message;
              }
            ?>
            <br>
            </p>
            <p><strong><?php echo _("Détails:");?></strong>
            <?php 
              if(!empty($api_error_msg->detailTranslated))
              {
                echo $api_error_msg->detailTranslated;
              }
              else
              {
                echo $api_error_msg->detail;
              }
            ?>
            <br>
            </p>
          </div>
          <?php
				}
				
				?>
              
			  <?php if($api_error==false):?>
              
              <h1 class="green-bar-view"><?php echo _("Auberge");?> <?php echo var_check($hostel->property_name,""); ?><?php echo ' - '.var_check($hostel->city,"");?></h1>        
              <ul class="view-menu tabing">                
                <li><a href="#tab1"><?php echo _("Info & Prix");?></a></li>
                <li><a href="#tab2" onClick="appendBootstrap()"><?php echo _("Cartes et Directions");?></a></li>
                <li><a id="tab-comment" href="#tab3"><?php echo _("Commentaires");?><?php //if ($hostel_comments->num_rows()>0){ echo '('.$hostel_comments->num_rows().')';}?></a></li>
              </ul>
              
              <?php 
                //echo "HW rating: ". $this->Db_hw_rating->get_hw_rating($hostel->property_number);
                
              	if(!empty($hostel->rating))
              	{
              	  ?><ul class="eval-view">
                        <li class="moyenne"><?php echo _("évaluation moyenne");?></li>
                        <li><span><?php echo $hostel->rating;?> %</span></li>
              	  	</ul><?php
								}
								
								/*if(is_null($hostel_rating)||($hostel_rating->rating_count<1))
              	{
              	  
              	}
              	else
              	{
              	  ?><ul class="eval-view">
                        <li class="moyenne"><?php echo _("évaluation moyenne");?></li>
                        <li><span><?php echo $hostel_rating->average_rating;?> %</span></li>
              	  	</ul><?php
								}*/
              	
               ?>
              
              <div id="tab1" class="hostel-view tabdiv">
              	
								<div id="loading_dispo">
								<p><?php echo _('Recherche de disponibilités...'); ?></p>
								</div>
								             	
                <div id="booking-table"></div>
                
								<?php if (isset($hostel->PropertyImages)){?>
								<div class="slideshow">                	
										<div class="slides">
											<div class="main-pic">                      	
												<?php foreach ($hostel->PropertyImages as $image) :?>    
												<?php if ($image->imageType == 'Main'){?>
																								
												<a rel="prettyPhoto[<?php echo var_check($hostel->property_name,""); ?>]" href="<?php echo var_check($image->imageURL,"/test.jpg"); ?>" alt="<?php echo $hostel->property_name; ?>">
												<img class="slide-zoom" title="<?php echo _("Click to enlarge"); ?>" width="200" height="144" src="<?php echo base_url();?>images/slide-zoom.png" alt="" />
												<img class="main" width="200" height="144" src="<?php echo var_check($image->imageURL,"/test.jpg"); ?>" alt="<?php echo $hostel->property_name; ?>" /></a>    
												<?php } endforeach;?>
											</div>
											<div class="control">
												<a class="control-left" href="#">Previous</a>
												<a class="control-right" href="#">Next</a>                        
											</div>  
									</div>
								</div>
								<?php }?>            
                	
                  <p class="last-comment-title"><strong><?php echo var_check($hostel->property_name,"");?></strong> - <?php echo var_check($hostel->property_type,"");?></p>
                
									<?php if(!empty($hostel->descriptionTranslated)){?>
										<p><?php echo strip_tags(word_limiter($hostel->descriptionTranslated, 60));?></p>
									<?php }else{?>
										<p><?php echo strip_tags(word_limiter($hostel->description, 60));?></p>
									<?php }?>
              
                <div class="clear"></div>
               
								<div class="content-block">
                	<h2><?php echo _("À propos de"); ?> <?php echo var_check($hostel->property_name,"");?></h2>
                  
                  <?php if (!empty($hostel->descriptionTranslated)){?>
                  <select class="select-translate">
                    <option value="translate"><?php echo _("Voir la version traduite"); ?></option>
                    <option value="original"><?php echo _("Voir l'original"); ?></option>
                  </select>
                  <?php }?>  
                  <div class="about fix-width">
                      
                      <?php //TODO this function nl2br return weird stuff sometime, need to have something more robust?>
                      <?php 
  
                      if(!empty($hostel->descriptionTranslated))
                      {
                        echo '<div class="translated">'.$hostel->descriptionTranslated.'</div>';
                        echo '<div class="original" style="display:none;">'.nl2p(var_check($hostel->description,""),false,true).'</div>';
                      }
                      else
                      {
                        echo nl2p(var_check($hostel->description,""),false,true);
                      }
                      ?>
                      
                  </div>
                </div>
                
                
                <?php if (isset($hostel->facilities)){?>
                <div class="content-block">
                  <h2><?php echo _("Commodité");?></h2>
                  <?php if (!empty($hostel->Facilities->facilityTranslated)){?>
                  <select class="select-translate">
                    <option value="translate"><?php echo _("Voir la version traduite"); ?></option>
                    <option value="original"><?php echo _("Voir l'original"); ?></option>
                  </select>
                  <?php }?>  
									<div class="round-block clearfix">
                  <ul class="float-list green-li increase1 <?php if(!empty($hostel->facilitiesTranslated)){?>translated<?php } ?>">
                    <?php 
                    $numloop = count($hostel->facilities) - 1; 
                    $breakloop = round($numloop/2);
                    $loopcount = 0;
                    
                    $facilities = $hostel->facilities;
                    
                    if(!empty($hostel->facilitiesTranslated))
                    {
                      $facilities = $hostel->facilitiesTranslated;
                      
                    }
                    
                    foreach ($facilities as $facility)
                    {                 	
                      if(!empty($facility))
                      {
                      
                        $loopcount++;
                        ?>
                        <li><?php echo stripslashes(var_check($facility,""));?></li>
                        
                        <?php 
                        if ($loopcount == $breakloop)
                        {
                          ?>
                          </ul><ul class="float-list green-li increase1 <?php if(!empty($hostel->facilitiesTranslated)){?>translated<?php } ?>">
                          <?php 
                        }
                      }
                    }
                    ?>
                   
                  </ul>
									<?php if(!empty($hostel->facilitiesTranslated)){?>
                  <ul class="float-list green-li increase1 original marg20l" style="display:none;">
                    <?php 
                    $numloop = count($hostel->facilities) - 1; 
                    $breakloop = round($numloop/2);
                    $loopcount = 0;
                    
                    $facilities = $hostel->facilities;
                                    
                    foreach ($facilities as $facility)
                    {                 	
                      if(!empty($facility))
                      {
                      
                        $loopcount++;
                        ?>
                        <li><?php echo stripslashes(var_check($facility,""));?></li>
                        
                        <?php 
                        if ($loopcount == $breakloop)
                        {
                          ?>
                          </ul><ul class="float-list green-li increase1 original" style="display:none;">
                          <?php 
                        }
                      }
                    }
                    ?>
                   
                  </ul>
                
									<?php } ?>
                	</div>
                </div>
                <div class="clear"></div>
								<?php }?>
                
                 <?php //TODO Condition can be very long we should cut it if too long, limit word and have a read more thing that will toggle the full text ?>
                
                <?php if (!empty($hostel->conditions)){?>
                <div class="content-block">
                  <h2 class="dotted-line"><?php echo _("Informations Importantes");?></h2>
                  <?php if (!empty($hostel->conditionsTranslated)){?>
                  <select class="select-translate">
                    <option value="translate"><?php echo _("Voir la version traduite"); ?></option>
                    <option value="original"><?php echo _("Voir l'original"); ?></option>
                  </select>
                  <?php }?>  
                  <div class="margbot20 fix-width">         
										<?php
                    if(!empty($hostel->conditionsTranslated))
                    {
                      echo '<div class="translated">'.$hostel->conditionsTranslated.'</div>';
                      echo '<div class="original" style="display:none;">'.nl2p(var_check($hostel->conditions,""),false,true).'</div>';
                    }
                    else
                    {
                      echo nl2p(var_check($hostel->conditions,""),false,true);
                    }
                    ?>
                  </div>
                </div>
								<?php }?>
								
								<?php // Show 2 latest comment ?>								
								
              	<?php  /*
                if((!is_null($hostel_comments))&&($hostel_comments->num_rows()>0))
                {$countcomment = 0;?>
								
								<h2 class="dotted-line margbot15"><?php echo _("Commentaires et évaluations de voyageurs");?></h2>
								
                <?php foreach($hostel_comments->result() as $comment)
                  {if($countcomment ==2){break;}$countcomment++
                    ?>
                    <div class="comment-list ">
                                         
                        <?php echo nl2p(var_check($comment->comment_content,""),false,true);?>
     
                        <p class="auteur"><?php printf(gettext("Par %s | Le %s"), $comment->firstname,date_conv($comment->comment_date, $this->wordpress->get_option('aj_date_format'))); ?> <?php echo $comment->user_country;?></p>
                        
                        
                        <div class="actual-star star-<?php echo $comment->user_rating;?>">
                          <span></span>
                        </div>
                
                    </div>
                    <?php
                  }?>
									
                <?php }*/?>
               
              </div>
                
              <div id="tab2" class="map-view tabdiv ui-tabs-hide">
                                
                <div class="margbot20">
                    <h2 class="dotted-line"><?php echo _("Adresse");?></h2>
                    <p class="pad-left"><?php echo var_check($hostel->address1,""); echo ' '.var_check($hostel->address2,""); echo ', '.var_check($hostel->city,"");  echo ', '.var_check($hostel->country,"") ;?></p>
                </div>
                
                <h2 class="dotted-line"><?php echo _("Cartes");?></h2>

								<div id="map-wrap" class="margbot20">
									<div id="map_canvas"></div>
								</div>
								
								<h2 id="street_panel_title" class="dotted-line" style="display:none;">><?php echo _("Street View");?></h2>
                <div id="street_panel-wrap" class="margbot20" style="display:none;">								
                  <div id="street_panel" style="display:none; width: 600px; height: 450px;"></div>
                </div>
							<?php /*?>	
								<h2 class="dotted-line"><?php echo _("Street View");?></h2>
								<div id="street-wrap" class="margbot20">
									<div id="street_canvas"></div>
								</div><?php */?>
               
							 <?php if(!empty($hostel->directions )){?>
                <div class="content-block">
                  <h2 class="dotted-line"><?php echo _("Directions");?></h2>
                  <?php if (!empty($hostel->directionsTranslated)){?>
                  <select class="select-translate">
                    <option value="translate"><?php echo _("Voir la version traduite"); ?></option>
                    <option value="original"><?php echo _("Voir l'original"); ?></option>
                  </select>
                  <?php }?>  
                
                  <div class="margbot20 fix-width">   
                    
                    <?php
                    if(!empty($hostel->directionsTranslated))
                    {
                      echo '<div class="translated">'.$hostel->directionsTranslated.'</div>';
											echo '<div class="original" style="display:none;">'.nl2p(var_check($hostel->directions,""),false,true).'</div>';
                    }
                    else
                    {
                      echo nl2p(var_check($hostel->directions,""),false,true);
                    }
                    ?>
                    
                  </div>
                </div>
								<?php }?>   
								           
              </div>
              
              <div id="tab3" class="comment-view tabdiv ui-tabs-hide">
              
              <script type="text/javascript">
								function update_review_list()
								{
									$.ajax(
													{
															type:"POST",
															url:"<?php echo site_url();?>chostel/reviews/<?php echo $hostel->property_number;?>",
															success:function(data)
															{
																$("#comment-list-part").html(data);
															}
													});
								}
								$(document).ready(function(){update_review_list();});
								</script>
								
								 <?php if ($this->input->get('comment', TRUE) == "insert"){?>
                
                <div class="enter-comment">
                
                	<h2 class="dotted-line margbot15"><?php  printf(gettext("Laissez vos impressions sur %s"),var_check($hostel->property_name,""));?></h2>
                    <form action="" method="POST" id="comment-insert">
                      <input type="hidden" name="property_number" value="<?php echo $hostel->property_number?>">
                      <input type="hidden" name="property_name" value="<?php echo $hostel->property_name?>">
                      <input type="hidden" name="property_city" value="<?php echo $hostel->city?>">
                      <input type="hidden" name="property_country" value="<?php echo $hostel->country?>">
                      <input type="hidden" name="property_type" value="<?php echo $hostel->property_type?>">
                      <table>
                        <tr>
                      	  <td><label for="firstname"><?php echo _("Votre Prénom:"); ?></label>
                          <input type="text" id="comment_firstname" name="firstname" class="large-text" value="<?php echo set_value('firstname', ''); ?>"/></td>
                          <td><?php echo form_error('firstname'); ?></td>
                          <script type="text/javascript">
														var comment_firstname = new LiveValidation('comment_firstname', { validMessage: ' ', wait: 500});
														comment_firstname.add(Validate.Presence, {failureMessage: "<?php echo _('Champ obligatoire'); ?>"});
														
														comment_firstname.add( Validate.Length, { minimum: 2 } );
            						  </script>
                        </tr> 
                        <tr>
                      	  <td><label for="lastname"><?php echo _("Votre Nom (ne sera pas publié):");?></label>
                          <input type="text" id="comment_name" name="lastname" class="large-text" value="<?php echo set_value('lastname', ''); ?>"/></td>
                          <td><?php echo form_error('lastname'); ?></td>
                          <script type="text/javascript">
														var comment_name = new LiveValidation('comment_name', { validMessage: ' ', wait: 500});
														comment_name.add(Validate.Presence, {failureMessage: "<?php echo _('Champ obligatoire'); ?>"});
														
														comment_name.add( Validate.Length, { minimum: 2 } );
													</script>
                        </tr> 
                        <tr>
                          <td>
                          <label for="email"><?php echo _("Votre Email (ne sera pas publié):");?></label>
                          <input type="text" id="comment_email" name="email" class="large-text" value="<?php echo set_value('email', ''); ?>"/><?php echo form_error('email'); ?>
                          </td>
                          <td><?php echo form_error('email'); ?></td>
                          <script type="text/javascript">
														var comment_email = new LiveValidation('comment_email', { validMessage: ' ', wait: 500});
														comment_email.add(Validate.Email, {failureMessage: "<?php echo _('Insérer un courriel valide'); ?>"});
														comment_email.add(Validate.Presence, {failureMessage: "<?php echo _('Champ obligatoire'); ?>"});
													</script>
                        </tr>
                        
                        <tr>
                          <td> 
                          <label for="nationality"><?php echo _("Nationalité :");?></label>
                          <?php $this->Db_country->select_country("Nationality","nationality",set_value('nationality', ''),"style=\"width: auto;\"","en",$this->site_lang,_('Choisir le pays'));  ?>
                          </td>
                          <td><?php echo form_error('nationality'); ?></td>
                          <script type="text/javascript">
														var Nationality = new LiveValidation('Nationality', { validMessage: ' ', wait: 500});
														Nationality.add(Validate.Presence, {failureMessage: "<?php echo _('Champ obligatoire'); ?>"});
													</script>
                        </tr>
                        
                        <tr>
                          <td>
                           <label for=""><?php echo _("Veuillez évaluer votre expérience:");?></label>
                              <div class="stars clearfix">
                              <input id="star_radio" type="radio" class="star {split:2}" name="star-rating" value="1" <?php echo set_radio('star-rating', '1'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="2" <?php echo set_radio('star-rating', '2'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="3" <?php echo set_radio('star-rating', '3'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="4" <?php echo set_radio('star-rating', '4'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="5" <?php echo set_radio('star-rating', '5'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="6" <?php echo set_radio('star-rating', '6'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="7" <?php echo set_radio('star-rating', '7'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="8" <?php echo set_radio('star-rating', '8'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="9" <?php echo set_radio('star-rating', '9'); ?>/>
                              <input type="radio" class="star {split:2}" name="star-rating" value="10" <?php echo set_radio('star-rating', '10'); ?>/>
                              
                              </div>
                           </td>
                           <td><?php echo form_error('star-rating'); ?></td>
                        </tr>
                        <tr>
                           <td> 
                           <label for="comment"><?php printf(gettext("Vos commentaires sur %s :"),var_check($hostel->property_name,""));?></label>
                           <textarea id="text_comment" name="comment" cols="50" rows="10"><?php echo set_value('comment', ''); ?></textarea>
                           </td>
                           <td><?php echo form_error('comment'); ?></td>
                           <script type="text/javascript">
														var text_comment = new LiveValidation('text_comment', { validMessage: ' ', wait: 500});
														text_comment.add(Validate.Presence, {failureMessage: "<?php echo _('Champ obligatoire'); ?>"});
                            </script>
                        </tr>
                        
                        <tr>
                          <td>
                           <label style="padding-top:10px; padding-bottom:5px;" for=""><?php echo _("La date de votre dernier séjour à cet endroit :");?></label>
                           
                           <?php select_month("month","month_comment","small-select",set_value("month_comment",NULL)); ?>
                              
                           <?php select_year("year-comment","year_comment","small-select",0,-11,set_value("year_comment",NULL)); ?>
                           </td>
                           <td></td>
                        </tr>
                        <tr>
                          <td>   
                              <input type="submit" name="comment-submit" id="comment-submit" value="<?php echo _("Soumettre");?>" />
                          </td>
                          <td></td>
                        </tr>

                      </table>
                    </form>                    
                </div>
                
                <?php  }?>
								
								<div id="comment-list-part">
									<p class="pad-left"><img src="<?php echo base_url();?>images/loading_dispo.gif" alt="" /></p>
								</div>
                
               
                
              </div><?php ?>
              
<?php /* ?><br>
 <textarea cols="50" rows="25">
 <?php 
 print_r($hostel);
 ?>
 </textarea><?php  */ ?>
              
              
             <?php endif; //endif api error?>
             
             </div> 
          
          </div> 

<?php //This is the sidebar ?>

		<?php if($api_error==false):?>

		 <div id="sidebar">
            <div class="widget">
            <?php if(is_null($hostel_min_price)):?>
              <h2 class="blue-bar-300"><strong><?php echo _('Disponibilités');?>:</strong></h2>              
            <?php else:?>
             <h2 class="blue-bar-300"><strong><?php echo _('Disponibilités');?> - <span class="small-white"><?php echo _('à partir de');?></span> <span class="dispo-price"><?php echo $hostel_min_price; ?></span></strong></h2>
            <?php endif;?>
              
               <?php //TODO Support this form to check availability ?>
                <form style="clear:both;" id="dispo-form" action="" method="">
                  <input type="hidden" id="book-property-number" name="book-property-number" value="<?php echo $hostel->property_number;?>" />
                  <input type="hidden" id="book-property-name" name="book-property-name" value="<?php echo $hostel->property_name;?>" />
                  
                  <ul>
                     <li>
                     <?php 
                      if(!isset($date_selected))
                      {
                        $date_selected = get_date_default(3);
                      }
                      //select_date(_('Arrivée le:'),"book-date-day","book-date-day","book-date-month","book-date-month",$date_selected);
                      ?>
                       <label for="book-pick"><?php echo _('Arrivée le:');?></label>
                       <input type="text" id="book-pick" name="book-pick" value="<?php echo $date_selected;?>" /> 
                    </li>      
                    <li>
                    <?php 
                    if(!isset($numnights_selected))
                    {
                      $numnights_selected = 2;
                    }
                    select_nights(_('Nuits:'),"book-night","book-night",$numnights_selected); ?>
                    </li>    
                    <div style="clear:both;"></div>
                    <li>
                    <label style="width:100%" for="book-property-currency"><?php echo _("Devise:");?></label>
                    <?php $this->Db_currency->select_currency("book-property-currency","book-property-currency",$currency,"",$this->site_lang); ?>
                    <li class="book-submit">
                      <input onfocus="this.blur()" type="button" name="book-submit" id="book-submit" value="<?php echo _("Rechercher");?>" OnClick="$('ul.tabing').tabs('select', 0);checkAvailability('<?php echo site_url($this->hostel_controller); ?>','book-property-number','book-pick','book-night','book-property-name','book-property-currency','<?php echo _('Date invalide'); ?>');" />
                    </li>
                  </ul>
                </form>
               
            </div>
            
            <?php // $this->load->view('includes/share'); ?>
            <?php $this->load->view('includes/fblike'); ?>
						<?php $this->load->view('includes/currency'); ?>
						<?php $this->load->view('includes/testimonials'); ?>            
            <?php $this->load->view('includes/siteinfo'); ?>
            
          </div>
          
         <?php endif; //endif api error?>
          